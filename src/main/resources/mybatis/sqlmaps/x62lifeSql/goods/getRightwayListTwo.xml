<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="getRightwayListTwo">
<!--    'System        : m.62life.com-->
<!--    'Program       :-->
<!--    'Title         : 자연이랑모바일 - 오늘발송 상품 페이지 단위로 가져오기-->
<!--    'File          : get_rightaway_list_m.asp-->
<!--    'Program Type  : asp-->
<!--    'Analyst       :-->
<!--    'Author        : hwkim-->
<!--    'Date Started  : 20170426-->
<!--    'Last Modified :-->
<!--    'Called By     :-->
<!--    'Parameters    :-->
<!--    'Purpose       :-->
<!--    'Version       :-->
<!--    '-->
<!--    'Modified   Author  V/M     Reason For Modification-->
<!--    '20170426   hwkim   0.9     처음 작성-->
<!--    '20170612   hwkim   0.9.1   판매 요일과 시간 제한 추가 (1차 오픈 제한)-->
<!--    '20180803   hwkim   0.9.2   상품등급 라벨 표시, 할인율 사각형스티커 변경 등-->
    <select id="getRightWayListTwoPaging">
        /* getRightWayListTwoPaging 상품 리스트2 페이징*/
        SELECT CEILING( CAST(COUNT(1) AS FLOAT)/#{intPagePerItem}) maxPage
             , COUNT(a.gdcd) CNT
        FROM (
                 SELECT gdcd
                 FROM gd_master
                  WHERE useyn = 'Y'
                    AND divcd = '30'
                    AND thedaysyn = 'Y'
                    AND dispatchtype = 'I'
                 <if test="div1 != ''">
                     AND exdiv1 = #{div1}
                 </if>
                 <if test="rightawaysearch != ''">
                     AND gdname LIKE '%' + rightawaysearch + '%'
                 </if>
             ) a
    </select>
    <select id="getRightWayListTwo">
        /* getRightWayListTwo 상품 리스트2 페이징*/
        SELECT *
        FROM (
                 SELECT FLOOR((ROW_NUMBER() OVER (ORDER BY a.odtype, a.gdcd)-1)/ #{intPagePerItem} + 1) AS cPage
                      , a.odtype
                      , a.gdcd
                      , a.gdname
                      , a.unit
                      , a.price1
                      , a.gdimg
                      , a.divcd
                      , a.div1
                      , a.indt
                      , a.updt
                      , a.shortdesc
                      , a.saleprice
                      , a.soldoutyn
                      , a.gdcnt
                      , a.newyn
                      , a.qtysaleyn
                      , a.deliverydtyn
                      , a.origin
                      , a.producer
                      , a.address
                      , a.gradedesc
                      , a.odtype2
                      , a.thedaysyn
                 FROM (
                          SELECT '' odtype
                               , g.gdcd
                               , g.gdname
                               , g.unit
                               , g.price1
                               , g.gdimg
                               , g.divcd
                               , g.div1
                               , g.indt
                               , g.updt
                               , g.shortdesc
                               , dbo.getProductPrice( #{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) saleprice
                               , ISNULL(g.soldoutyn,'N') soldoutyn
                               , ISNULL(s.gdcnt,99999) gdcnt
                               , ISNULL(g.newyn,'N') newyn
                               , ISNULL(g.qtysaleyn,'N') qtysaleyn
                               , ISNULL(g.deliverydtyn,'N') deliverydtyn
                               , i.origin
                               , i.producer
                               , i.address
                               , ISNULL(t.cdname,'미지정') AS gradedesc
                               , '01' odtype2
                               , g.thedaysyn
                          FROM gd_master g
                            LEFT JOIN gd_item i ON i.gdcd = g.gdcd
                            LEFT JOIN cd_master t ON t.cdtype = #{typeFarm}
                                                 AND t.cdcode = i.typecd
                            LEFT JOIN gd_cnt s ON g.gdcd = s.gdcd
                           WHERE 1=1
                             AND g.useyn = 'Y'
                             AND g.divcd = '30'
                             AND g.thedaysyn = 'Y'
                             AND g.dispatchtype = 'I'
                             <if test="div1 != ''">
                                 AND g.exdiv1 = #{div1}
                             </if>
                             <if test="rightawaysearch != ''">
                                 AND g.gdname LIKE '%' + rightawaysearch + '%'
                             </if>
                      ) a
              ) AS pl
        WHERE cPage = #{intPage}
    </select>
</mapper>
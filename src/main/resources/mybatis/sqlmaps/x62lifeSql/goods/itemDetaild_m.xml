<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="itemDetaild_m">
<!--    'System        : m.62life.com-->
<!--    'Program       :-->
<!--    'Title         : 자연이랑모바일 - 상품 상세정보 확대 보기-->
<!--    'File          : item_detaild_m.asp-->
<!--    'Program Type  : asp-->
<!--    'Analyst       :-->
<!--    'Author        : hwkim-->
<!--    'Date Started  : 20161122-->
<!--    'Last Modified :-->
<!--    'Called By     :-->
<!--    'Parameters    :-->
<!--    'Purpose       :-->
<!--    'Version       :-->
<!--    '-->
<!--    'Modified   Author  V/M     Reason For Modification-->
    <select id="searchReservedProdList">
         /*searchReservedProdList (예약배송상품) */
        SELECT r.gdcd
             , r.gdnm AS gdname
             , r.unit
             , g.priceyn
             , r.gd_expalin AS explain
             , g.newyn
             , g.recommendyn
             , g.qtysaleyn
             , g.price1
             , dbo.getMasterPrice(g.gdcd) saleprice
             , dbo.getProductPrice(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) groupsaleprice
             , dbo.getIsGroupSaleGoods(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) isgroupsale
             , g.gdimg
             , r.divcd
             , r.divcd1 AS div1
             , c.cdcode
             , c.cdname
             , g.gdimg2
             , g.gdimg3
             , g.gdimg4
             , g.subgdcd1
             , g.subgdcd2
             , g.subgdcd3
             , g.subgdcd4
             , g.subgdcd5
             , g.shortdesc
             , g.expdt
             , g.vat
             , CASE WHEN ISNULL(g.deliverydtyn,'')='' THEN 'N' ELSE g.deliverydtyn END deliverydtyn
             , CASE WHEN ISNULL(r.recommandyn,'')='' THEN 'N' ELSE r.recommandyn END recommendyn
             , CASE WHEN ISNULL(g.soldoutyn,'')='' THEN 'N' ELSE g.soldoutyn END soldoutyn
             , ISNULL( gc.gdcnt ,99999) gdcnt
             , i.origin
             , i.producer
             , i.address
             , ISNULL(t.cdname,'미지정') AS gradedesc
             , m.smenucd
             , m.smenudesc
             , r.od_from
             , r.od_to
             , r.dlv_from
             , r.dlv_to
             , i.typecd AS gdtype
             , t.cdname AS gdtypename
             , t.cdname AS typename
             , r.packunit
        FROM od_reservegoods r
          JOIN gd_master g ON g.gdcd = r.gdcd
          JOIN cd_master c ON c.cdtype = '20'
                          AND c.cdcode = r.divcd1
          LEFT JOIN gd_item i ON i.gdcd = r.gdcd
          LEFT JOIN cd_master t ON t.cdtype = '09'
                               AND t.cdcode = i.typecd
          LEFT JOIN submenu m ON m.category = r.divcd1
                             AND sub_category like '%'+ g.div2 + '%'
          LEFT JOIN gd_cnt gc ON gc.gdcd = r.gdcd
         WHERE 1 = 1
           AND r.useyn = 'Y'
           AND r.gdcd = #{strGDCD}
    </select>

    <select id="searchBasicProdList">
        /* searchBasicProdList 일반상품 */
        SELECT g.gdcd
             , g.gdname
             , g.unit
             , g.priceyn
             , g.explain
             , g.newyn
             , g.recommendyn
             , g.qtysaleyn
             , g.price1
             , dbo.getMasterPrice(g.gdcd) saleprice
             , dbo.getProductPrice(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) groupsaleprice
             , dbo.getIsGroupSaleGoods(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) isgroupsale
             , g.gdimg
             , g.divcd
             , g.div1
             , g.gdimg2
             , g.gdimg3
             , g.gdimg4
             , g.subgdcd1
             , g.subgdcd2
             , g.subgdcd3
             , g.subgdcd4
             , g.subgdcd5
             , g.shortdesc
             , g.expdt
             , g.vat
             , c.cdcode
             , c.cdname
             , CASE WHEN ISNULL(g.deliverydtyn,'')='' THEN 'N' ELSE g.deliverydtyn END deliverydtyn
             , CASE WHEN ISNULL(g.recommendyn,'')='' THEN 'N' ELSE g.recommendyn END recommendyn
             , CASE WHEN ISNULL(g.soldoutyn,'')='' THEN 'N' ELSE g.soldoutyn END soldoutyn
             , ISNULL(s.gdcnt,99999) gdcnt
             , i.origin
             , i.producer
             , i.address
             , ISNULL(t.cdname,'미지정') AS gradedesc
             , m.smenucd
             , m.smenudesc
             , i.typecd AS gdtype
             , t.cdname AS gdtypename
             , t.cdname AS typename
             , '' packunit
        FROM gd_master g
          JOIN cd_master c ON c.cdtype = '20'
                          AND c.cdcode = div1
          LEFT JOIN gd_cnt s ON g.gdcd = s.gdcd
          LEFT JOIN gd_item i ON i.gdcd = g.gdcd
          LEFT JOIN cd_master t ON t.cdtype = '09'
                               AND t.cdcode = i.typecd
          LEFT JOIN submenu m ON m.category = g.div1 AND sub_category like '%'+ g.div2 + '%'
         WHERE 1 = 1
           AND g.useyn = 'Y'
           AND g.gdcd = #{strGDCD}
    </select>
</mapper>

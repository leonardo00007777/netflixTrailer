<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="weekHot">
<!--    'System        : m.62life.com-->
<!--    'Program       :-->
<!--    'Title         : (사용하지 않음)자연이랑모바일 - 주간인기상품-->
<!--    'File          : weekhot_m.asp-->
<!--    'Program Type  : asp-->
<!--    'Analyst       :-->
<!--    'Author        : hwkim-->
<!--    'Date Started  : 20130611-->
<!--    'Last Modified :-->
<!--    'Called By     :-->
<!--    'Parameters    :-->
<!--    'Purpose       :-->
<!--    'Version       :-->
<!--    '-->
<!--    'Modified   Author  V/M     Reason For Modification-->
<!--    '-&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;    &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--    '20130611   hwkim   0.9     처음 작성-->
<!--    '20151110   hwkim   0.9.1   상품 리스트 표시 디자인 통일-->
<!--    '20161205   hyeok   0.9.2   리뉴얼 적용 header, footer표시-->
<!--    '20170329   hwkim   0.9.3   할인 가격 표시 변경-->
    <select id="weekHotProdList">
        /* weekHotProdList 인기 상품목록표시 시작 */
        SELECT * FROM (
                        SELECT Top 10 g.gdcd
                             , g.gdname
                             , g.unit
                             , g.priceyn
                             , g.newyn
                             , g.recommendyn
                             , g.qtysaleyn
                             , g.price1
                             , dbo.getMasterPrice(g.gdcd) saleprice
                             , g.gdimg
                             , g.divcd
                             , g.div1
                             , c.cdcode
                             , c.cdname
                             , CASE WHEN ISNULL(g.deliverydtyn,'')='' THEN 'N' ELSE g.deliverydtyn END deliverydtyn
                             , CASE WHEN ISNULL(g.soldoutyn,'')='' THEN 'N' ELSE g.soldoutyn END soldoutyn
                             , ISNULL(s.gdcnt,99999) gdcnt
                             , i.origin
                             , i.producer
                             , i.address
                             , ISNULL(t.cdname,'미지정') AS gradedesc
                             , m.smenucd
                             , m.smenudesc
                             , SUM(a.gdcnt) TCOUNT
                             , SUM(a.price) TSALES
                        FROM od_goods a
                          JOIN gd_master g ON g.gdcd = a.gdcd
                          JOIN cd_master c ON c.cdtype = '20'
                                          AND c.cdcode = div1
                          LEFT JOIN gd_cnt s ON g.gdcd = s.gdcd
                          LEFT JOIN gd_item i ON i.gdcd = g.gdcd
                          LEFT JOIN cd_master t ON t.cdtype = '09'
                                               AND t.cdcode = i.typecd
                          LEFT JOIN submenu m ON m.category = g.div1
                                             AND sub_category
                                            LIKE '%'+ g.div2 + '%'
                         WHERE 1 = 1
                           AND g.divcd = '30' AND g.useyn = 'Y'
                           <![CDATA[
                           AND DATEDIFF(d,a.indt,GETDATE()) <= #{basicDays}
                           ]]>
                           AND g.div1 IN ('01','04','05')
                        GROUP BY g.gdcd, g.gdname, g.unit, g.priceyn
                               , g.newyn, g.recommendyn, g.qtysaleyn
                               , g.price1, dbo.getMasterPrice(g.gdcd)
                               , g.gdimg, g.divcd, g.div1
                               , c.cdcode, c.cdname, g.deliverydtyn
                               , g.soldoutyn, ISNULL(s.gdcnt,99999)
                               , i.origin, i.producer, i.address
                               , t.cdname, m.smenucd, m.smenudesc
                        ORDER BY TCOUNT DESC
                        UNION ALL
                        SELECT Top 15 g.gdcd
                             , g.gdname
                             , g.unit
                             , g.priceyn
                             , g.newyn
                             , g.recommendyn
                             , g.qtysaleyn
                             , g.price1
                             , dbo.getMasterPrice(g.gdcd) saleprice
                             , g.gdimg
                             , g.divcd
                             , g.div1
                             , c.cdcode
                             , c.cdname
                             , CASE WHEN ISNULL(g.deliverydtyn,'')='' THEN 'N' ELSE g.deliverydtyn END deliverydtyn
                             , CASE WHEN ISNULL(g.soldoutyn,'')='' THEN 'N' ELSE g.soldoutyn END soldoutyn
                             , ISNULL(s.gdcnt,99999) gdcnt
                             , i.origin
                             , i.producer
                             , i.address
                             , ISNULL(t.cdname,'미지정') AS gradedesc
                             , m.smenucd
                             , m.smenudesc
                             , SUM(a.gdcnt) TCOUNT
                             , SUM(a.price) TSALES
                        FROM od_goods a
                          JOIN gd_master g ON g.gdcd = a.gdcd
                          JOIN cd_master c ON c.cdtype = '20'
                                          AND c.cdcode = div1
                          LEFT JOIN gd_cnt s ON g.gdcd = s.gdcd
                          LEFT JOIN gd_item i ON i.gdcd = g.gdcd
                          LEFT JOIN cd_master t ON t.cdtype = '09'
                                               AND t.cdcode = i.typecd
                          LEFT JOIN submenu m ON m.category = g.div1
                                             AND sub_category
                                            LIKE '%'+ g.div2 + '%'
                         WHERE 1 = 1
                           AND g.divcd = '30'
                           AND g.useyn = 'Y'
                          <![CDATA[
                           AND DATEDIFF(d,a.indt,GETDATE()) <= #{basicDays}
                          ]]>
                           AND g.div1 IN ('10','20','70','90')
                        GROUP BY g.gdcd, g.gdname, g.unit, g.priceyn
                               , g.newyn, g.recommendyn, g.qtysaleyn
                               , g.price1, dbo.getMasterPrice(g.gdcd)
                               , dbo.getProductPrice(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd)
                               , c.cdcode, c.cdname, g.deliverydtyn
                               , g.soldoutyn, ISNULL(s.gdcnt,99999)
                               , i.origin, i.producer, i.address
                               , t.cdname, m.smenucd, m.smenudesc
                        ORDER BY TCOUNT DESC
                     ) x
        ORDER BY div1
    </select>

    <select id="weekHotNewProdList">
        /* weekHotNewProdList 새로나온 상품목록표시*/
        SELECT Top 20 g.gdcd
             , g.gdname
             , g.unit
             , g.priceyn
             , g.newyn
             , g.recommendyn
             , g.qtysaleyn
             , g.price1
             , dbo.getMasterPrice(g.gdcd) saleprice
             , dbo.getProductPrice(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) groupsaleprice
             , dbo.getIsGroupSaleGoods(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) isgroupsale
             , g.gdimg
             , g.divcd
             , g.div1
             , c.cdcode
             , c.cdname
             , CASE WHEN ISNULL(g.deliverydtyn,'')='' THEN 'N' ELSE g.deliverydtyn END deliverydtyn
             , CASE WHEN ISNULL(g.soldoutyn,'')='' THEN 'N' ELSE g.soldoutyn END soldoutyn
             , ISNULL(s.gdcnt,99999) gdcnt
             , i.origin
             , i.producer
             , i.address
             , ISNULL(t.cdname,'미지정') AS gradedesc
             , m.smenucd
             , m.smenudesc
        FROM gd_master g
          JOIN cd_master c ON c.cdtype = '20'
                          AND c.cdcode = div1
          LEFT JOIN gd_cnt s ON g.gdcd = s.gdcd
          LEFT JOIN gd_item i ON i.gdcd = g.gdcd
          LEFT JOIN cd_master t ON t.cdtype = '09'
                               AND t.cdcode = i.typecd
          LEFT JOIN submenu m ON m.category = g.div1
                             AND sub_category
                             LIKE '%'+ g.div2 + '%'
         WHERE 1 = 1
           AND g.divcd = '30' AND g.useyn = 'Y'
           AND newyn = 'Y'
        ORDER BY g.div1
    </select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="infinitList">
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 자연이랑모바일 - 리스트 페이지 템플릿
    'File          : listpage_m.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : <link rel="stylesheet" href="/m/font-awesome/css/font-awesome.min.css" />
    'Date Started  : 20130628
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification
    
    '20130628   <link rel="stylesheet" href="/m/font-awesome/css/font-awesome.min.css" />   0.9     처음 작성-->
    
    <select id="templateNormalProdPaging">
        /*templateNormalProdPaging 일반 상품 페이징*/
        SELECT CEILING( CAST(COUNT(1) AS FLOAT)/#{intPagePerItem}) MAXPAGE
             , COUNT(g.gdcd) CNT
        FROM gd_master g
          JOIN cd_master c
            ON c.cdtype = '20'
           AND c.cdcode = div1
          LEFT JOIN gd_cnt s
                 ON g.gdcd = s.gdcd
          LEFT JOIN gd_item i
                 ON i.gdcd = g.gdcd
          LEFT JOIN submenu m
                 ON m.category = g.div1
                AND sub_category like '%'+ g.div2 + '%'
         WHERE 1 = 1 
           AND g.useyn = 'Y'
         <if test='strGdtype != ""'>
             AND g.div1 = #{strGdtype}
         </if>
         <if test='strRs1SmenuCd != "" '>
             AND g.div2 IN (#{strRs1SubCategory})
         </if>
    </select>

    <select id="templateSearchNormalProd">
        /* templateSearchNormalProd 일반상품 리스트 조회*/
        SELECT * FROM ( 
                        SELECT FLOOR( (ROW_NUMBER() OVER ( ORDER BY g.div1, m.smenucd, g.gdcd ) - 1 ) /  #{intPagePerItem}  + 1) AS PAGE
                             , g.gdcd
                             , g.gdname
                             , g.unit
                             , g.priceyn
                             , g.newyn
                             , g.recommendyn
                             , g.qtysaleyn
                             , g.price1
                             , dbo.getMasterPrice(g.gdcd) saleprice
                             , dbo.getProductPrice(#{strMEMGRPCD},#{strGroupSalePolicy},g.gdcd) groupsaleprice
                             , dbo.getIsGroupSaleGoods(#{strMEMGRPCD},#{strGroupSalePolicy},g.gdcd) isgroupsale
                             , g.gdimg
                             , g.divcd
                             , g.div1
                             , c.cdcode
                             , c.cdname
                             , CASE WHEN ISNULL(g.deliverydtyn,'')='' THEN 'N'
                                    ELSE g.deliverydtyn
                               END deliverydtyn
                             , CASE WHEN ISNULL(g.soldoutyn,'')='' THEN 'N'
                                    ELSE g.soldoutyn
                               END soldoutyn, ISNULL(s.gdcnt,99999) gdcnt
                             , i.origin
                             , i.producer
                             , i.address
                             , ISNULL(t.cdname,'미지정') AS gradedesc
                             , m.smenucd
                             , m.smenudesc
                        FROM gd_master g
                          JOIN cd_master c
                            ON c.cdtype = '20'
                           AND c.cdcode = div1
                          LEFT JOIN gd_cnt s
                                 ON g.gdcd = s.gdcd
                          LEFT JOIN gd_item i
                                 ON i.gdcd = g.gdcd
                          LEFT JOIN cd_master t
                                 ON t.cdtype = '09'
                                AND t.cdcode = i.typecd
                          LEFT JOIN submenu m
                                 ON m.category = g.div1
                                AND sub_category like '%'+ g.div2 + '%'
                         WHERE 1 = 1
                           AND g.useyn = 'Y'
                    ) AS pl
                 WHERE PAGE = #{intPage}
    </select>
</mapper>
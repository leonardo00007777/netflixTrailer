<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="naturelove">
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 자연's love(자연이랑 대표상품) 페이지 #001(모바일)
    'File          : naturelove001_m.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hyeok
    'Date Started  : 20191126
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification

    '20191126   hyeok   0.9     처음작성-->

    <select id="categoryProdList">
        /* categoryProdList 카테고리 상품 리스트*/
        SELECT g.gdcd
             , g.gdname
             , g.gdimg
             , g.gdimg2
             , g.gdimg3
             , g.gdimg4
             , g.mgdimg1 
             , g.dispatchtype 
             , g.priceyn
             , ISNULL(g.qtysaleyn,'N') qtysaleyn 
             , g.price1 
             , dbo.getMasterPrice(g.gdcd) saleprice 
             , dbo.getProductPrice(#{strMEMGRPCD},#{strGroupSalePolicy},g.gdcd) groupsaleprice 
             , dbo.getIsGroupSaleGoods(#{strMEMGRPCD},#{strGroupSalePolicy},g.gdcd) isgroupsale 
             , g.div1, g.div2, g.divcd 
             , ISNULL(s.gdcnt,99999) gdcnt
             , g.minqty
             , g.maxqty 
             , g.shortdesc 
             , ISNULL(t.cdname,'미정') AS typename 
             , ISNULL(g.recommendyn,'N') recommendyn 
             , ISNULL(g.newyn,'N') newyn 
             , ISNULL(g.deliverydtyn,'N') deliverydtyn 
             , CASE g.dispatchtype WHEN 'I' THEN '11' 
                                   WHEN 'O' THEN '15' 
               END odtype 
             , ISNULL(g.thedaysyn,'N') thedaysyn 
             , ISNULL(g.soldoutyn,'N') soldoutyn 
             , CONVERT(CHAR(10),g.plandate,120) plandate 
             , ISNULL(g.reserveyn,'N') reserveyn 
             , g.exdiv1
             , m1.catdesc
             , g.exdiv2
             , m2.subcatdesc 
             , g.explain 
             , g.unit 
             , i.address
             , i.origin
             , i.producer 
             , ISNULL(r.od_from,'') od_from
             , ISNULL(r.od_to,'') od_to
             , ISNULL(r.dlv_from,'') dlv_from
             , ISNULL(r.dlv_to,'') dlv_to 
             , ISNULL(r.packunit,'') packunit 
             , g.expdt 
             , g.vat 
             , g.limitdelivery
             , g.bestbeforedate 
             , g.packaging
             , g.handling
             , g.precaution1
             , g.precaution2
             , g.importnote
             , g.addinformation
             , g.testidx 
             , g.optionp 
             , g.updt 
             , g.subgdcd1
             , g.subgdcd2
             , g.subgdcd3
             , g.subgdcd4
             , g.subgdcd5 
        FROM gd_master g
          LEFT JOIN gd_item i 
                 ON i.gdcd = g.gdcd
          LEFT JOIN cd_master t 
                 ON t.cdtype = '09'
                AND t.cdcode = i.typecd
          LEFT JOIN gd_cnt s 
                 ON g.gdcd = s.gdcd
          LEFT JOIN supplus t8 
                 ON g.scode = t8.suno
          LEFT JOIN od_reservegoods r 
                 ON g.gdcd = r.gdcd
                AND r.useyn = 'Y'
                <![CDATA[
                AND DATEDIFF(D,CONVERT(DATETIME,r.od_from,120),GETDATE()) >= 0
                AND DATEDIFF(D,GETDATE(),CONVERT(DATETIME,r.od_to,120)) >= 0
                ]]>
          LEFT JOIN exmenu m1 
                 ON g.exdiv1 = m1.cat1 
          LEFT JOIN exsubmenu m2 
                 ON g.exdiv1 = m2.cat1 
                AND g.exdiv2 = m2.cat2
         WHERE 1 = 1
           AND g.useyn = 'Y'
           AND g.gdcd = #{strNatureLoveGdCd}
           <![CDATA[
           AND g.divcd <> '10'
           ]]>
           AND (g.reserveyn = 'N' OR (g.reserveyn = 'Y' AND r.gdcd IS NOT NULL))
    </select>
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 자연's love(자연이랑 대표상품) 페이지 #003(모바일)
    'File          : naturelove003_m.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : chhyeon
    'Date Started  : 20200715
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification
    
    '20200715   chhyeon   0.9     초안작성(화식한우)-->
    
    <select id="natureLoveItemCategory">
       /*natureLoveItemCategory 자연이랑 대표상품 카테고리*/
       SELECT COUNT(CASE WHEN sl.slcat = '01' THEN 1 END) cntcat01 
            , COUNT(CASE WHEN sl.slcat = '02' THEN 1 END) cntcat02 
            , COUNT(CASE WHEN sl.slcat = '03' THEN 1 END) cntcat03 
            , COUNT(CASE WHEN sl.slcat = '04' THEN 1 END) cntcat04 
       FROM gd_master g 
         LEFT JOIN gd_cnt c 
                ON c.gdcd = g.gdcd 
         LEFT JOIN gd_item i 
                ON i.gdcd = g.gdcd 
         LEFT JOIN cd_master t6 
                ON t6.cdtype = '09' 
               AND t6.cdcode = i.typecd 
         LEFT JOIN submenu m 
                ON m.category = g.div1 
               AND sub_category 
              LIKE '%'+ g.div2 + '%' 
         LEFT JOIN od_reservegoods r 
                ON g.gdcd = r.gdcd 
               AND r.useyn = 'Y'
               <![CDATA[
               AND DATEDIFF(D,CONVERT(DATETIME,r.od_from,120),GETDATE()) >= 0 
               AND DATEDIFF(D,GETDATE(),CONVERT(DATETIME,r.od_to,120)) >= 0
               ]]>
         JOIN specialsellingl sl 
           ON slidx = #{strSpecialCd} 
          AND sl.slgdcd = g.gdcd 
        WHERE 1=1 
          AND g.useyn = 'Y' 
          AND (g.reserveyn = 'N' OR (g.reserveyn = 'Y' AND r.gdcd IS NOT NULL)) 
          AND ((g.divcd = '30' AND g.useyn = 'Y') 
                OR (g.divcd = '20' AND g.useyn = 'Y' AND g.gdcd IN (SELECT gdcd FROM gd_set WHERE gdsetyn='Y'))
              )  
    </select>
    
    <select id="natureLoveItemList">
        /*natureLoveItemList 자연이랑 대표상품 리스트*/
        SELECT g.gdcd
             , gdname
             , g.unit
             , g.price1
             , g.gdimg
             , g.divcd
             , g.div1
             , g.div2
             , g.indt
             , g.updt
             , g.shortdesc
             , dbo.getMasterPrice(g.gdcd) saleprice
             , dbo.getProductPrice(#{strMEMGRPCD},#{strGroupSalePolicy},g.gdcd) groupsaleprice
             , dbo.getIsGroupSaleGoods(#{strMEMGRPCD},#{strGroupSalePolicy},g.gdcd) isgroupsale
             , CASE WHEN ISNULL(g.soldoutyn,'N')='N' THEN 'N' ELSE g.soldoutyn END soldoutyn
             , ISNULL(g.newyn,'N') newyn, ISNULL(g.qtysaleyn,'N') qtysaleyn
             , g.recommendyn, g.plandate
             , ISNULL(c.gdcnt,99999) gdcnt
             , g.thedaysyn, g.optionp
             , ISNULL(t6.cdname,'미정') AS typename
             , g.priceyn
             , g.mgdimg1
             , g.dispatchtype
             , ISNULL(r.od_from,'') od_from
             , ISNULL(r.od_to,'') od_to
             , ISNULL(r.dlv_from,'') dlv_from
             , ISNULL(r.dlv_to,'') dlv_to
             , ISNULL(r.alltimesale,'-') alltimesale
             , i.origin
             , i.producer
             , i.address
             , m.smenucd
             , m.smenudesc
             , CASE g.dispatchtype WHEN 'I' THEN '11'
                                   WHEN 'O' THEN '15'
               END odtype
             , ISNULL(g.deliverydtyn,'N') deliverydtyn
             , ISNULL(g.reserveyn,'N') reserveyn
             , ISNULL(t6.cdname,'미지정') AS gradedesc
             , t6.cdcode
             , t6.cdname
             , sl.slcat
        FROM gd_master g
          LEFT JOIN gd_cnt c
                 ON c.gdcd = g.gdcd
          LEFT JOIN gd_item i
                 ON i.gdcd = g.gdcd
          LEFT JOIN cd_master t6
                 ON t6.cdtype = '09'
                AND t6.cdcode = i.typecd
          LEFT JOIN submenu m
                 ON m.category = g.div1
                AND sub_category
               LIKE '%'+ g.div2 + '%'
          LEFT JOIN od_reservegoods r
                 ON g.gdcd = r.gdcd
                AND r.useyn = 'Y'
               <![CDATA[
               AND DATEDIFF(D,CONVERT(DATETIME,r.od_from,120),GETDATE()) >= 0
               AND DATEDIFF(D,GETDATE(),CONVERT(DATETIME,r.od_to,120)) >= 0
               ]]>
            JOIN specialsellingl sl ON slidx = #{strSpecialCd} AND sl.slgdcd = g.gdcd 
         WHERE 1=1
           AND g.useyn = 'Y'
           AND (g.reserveyn = 'N' OR (g.reserveyn = 'Y' AND r.gdcd IS NOT NULL))
           AND ((g.divcd = '30' AND g.useyn = 'Y') OR (g.divcd = '20' AND g.useyn = 'Y' AND g.gdcd IN (SELECT gdcd FROM gd_set WHERE gdsetyn='Y')))
      ORDER BY sl.slcat 
    </select>
</mapper>
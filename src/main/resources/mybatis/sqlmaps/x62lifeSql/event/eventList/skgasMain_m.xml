<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="skgas">
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 2020년 SKSKC&C창립기념일 이벤트(모바일)
    'File          : skcnc_main_m.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hyeok
    'Date Started  : 20200406
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification

    '20200406   hyeok   0.9     초안작성(sk가스창립기념 코드 참조)-->
    <select id="eventHeader">
        /*eventHeader 이벤트 헤더*/
        SELECT *
        FROM specialsellingh
        WHERE shidx = #{sidx}
    </select>
    <select id="eventProdList">
        /*SKSKCnC창립기념일 기획전 포함 상품 정보 */
        SELECT *
        FROM (
               SELECT '11' odtype
                    , a.gdcd
                    , a.gdname
                    , a.unit
                    , a.price1
                    , a.gdimg
                    , a.mgdimg1
                    , a.divcd
                    , a.div1
                    , a.indt
                    , a.updt
                    , a.shortdesc
                    , ISNULL(z.gdcnt,99999) gdcnt
                    , CASE WHEN ISNULL(a.soldoutyn,'N')='N'
                             THEN 'N'
                           ELSE a.soldoutyn
                      END soldoutyn
                    , CASE WHEN ISNULL(a.deliverydtyn,'')=''
                             THEN 'N'
                           ELSE a.deliverydtyn
                      END deliverydtyn
                    , ISNULL(a.newyn,'N') newyn
                    , ISNULL(a.qtysaleyn,'N') qtysaleyn
                    , ISNULL(a.recommendyn,'N') recommendyn
                    , dbo.getMasterPrice(a.gdcd) saleprice
                    , c.cdcode
                    , c.cdname
                    , a.priceyn
                    , i.origin
                    , i.producer
                    , i.address
                    , ISNULL(t.cdname,'미지정') AS gradedesc
                    , '' od_from
                    , '' od_to
                    , '' dlv_from
                    , '' dlv_to
                    , a.thedaysyn
                    , x.slcat
                    , '' odtype2
               FROM gd_master a
                 JOIN cd_master c
                   ON c.cdtype = '20'
                  AND c.cdcode = a.div1
                 JOIN specialsellingl x
                   ON x.slgdcd = a.gdcd
                 LEFT JOIN gd_cnt z
                        ON z.gdcd = a.gdcd
                 LEFT JOIN gd_item i
                        ON i.gdcd = a.gdcd
                 LEFT JOIN cd_master t
                        ON t.cdtype = '09'
                       AND t.cdcode = i.typecd
                WHERE 1 = 1
                  AND a.useyn = 'Y'
                  AND a.divcd IN ('30','20')
                  AND x.slidx = #{sidx}
                  <if test="listingMode == 'OPT'">
                      AND ISNULL(a.optionp,'N') = 'N'
                  </if>
               UNION ALL
               SELECT '12' odtype
                    , r.gdcd
                    , r.gdnm gdname
                    , r.unit
                    , m.price1
                    , m.gdimg
                    , m.mgdimg1
                    , r.divcd
                    , r.divcd1 div1
                    , r.indt
                    , r.updt
                    , m.shortdesc
                    , ISNULL(gc.gdcnt,99999) gdcnt
                    , CASE WHEN ISNULL(soldoutyn,'N')='N'
                             THEN 'N'
                           ELSE soldoutyn
                      END soldoutyn
                    , CASE WHEN ISNULL(m.deliverydtyn,'')=''
                             THEN 'N'
                           ELSE m.deliverydtyn
                      END deliverydtyn
                    , ISNULL(m.newyn,'N') newyn
                    , 'N' qtysaleyn
                    , 'N' recommendyn
                    , dbo.getMasterPrice(r.gdcd) saleprice
                    , c.cdcode
                    , c.cdname
                    , 'Y' AS priceyn
                    , i.origin
                    , i.producer
                    , i.address
                    , ISNULL(t.cdname,'미지정') AS gradedesc
                    , r.od_from
                    , r.od_to
                    , r.dlv_from
                    , r.dlv_to
                    , m.thedaysyn
                    , x.slcat
                    , r.type odtype2
               FROM od_reservegoods r
                 JOIN gd_master m
                   ON r.gdcd = m.gdcd
                 JOIN cd_master c
                   ON c.cdtype = '20'
                  AND c.cdcode = m.div1
                 JOIN specialsellingl x
                   ON x.slgdcd = r.gdcd
                 LEFT JOIN gd_item i
                        ON i.gdcd = r.gdcd
                 LEFT JOIN cd_master t
                        ON t.cdtype = '09'
                       AND t.cdcode = i.typecd
                 LEFT JOIN gd_cnt gc
                        ON gc.gdcd = r.gdcd
                WHERE 1 = 1
                  AND r.useyn = 'Y'
                <![CDATA[
                  AND r.od_from <= CONVERT(VARCHAR,GETDATE(),23)
                  AND r.od_to >= CONVERT(VARCHAR,GETDATE(),23)
                ]]>
                  AND x.slidx = #{sidx}
               <if test="listingMode == 'OPT'">
                  AND ISNULL(m.optionp,'N') = 'N'
               </if>
            ) AS x
         WHERE 1 = 1
         <if test="shltoty != null">
             AND x.odtype = #{shltoty}
         </if>
         <choose>
             <when test="rsIusd == 'Y">
                ORDER BY x.slcat
            </when>
            <otherwise>
                ORDER BY cdcode
            </otherwise>
         </choose>
    </select>
</mapper>
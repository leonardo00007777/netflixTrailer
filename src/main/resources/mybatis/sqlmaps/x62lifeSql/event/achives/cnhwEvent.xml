<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cnhwEvent">
    <select id="cnhwEvent">
        /*cnhwEvent 청년한우 이벤트 상품 가져오기*/
        SELECT *
          FROM (
                   SELECT '11' odtype
                        , '01' odtype2
                        , g.gdcd
                        , g.gdname
                        , g.unit
                        , g.price1
                        , dbo.getMasterPrice(g.gdcd) saleprice
                        , dbo.getProductPrice(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) groupsaleprice
                        , dbo.getIsGroupSaleGoods(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) isgroupsale
                        , g.gdimg
                        , g.divcd
                        , g.div1
                        , c.cdcode
                        , c.cdname
                        , CASE WHEN ISNULL(g.deliverydtyn,'')=''
                                 THEN 'N'
                               ELSE g.deliverydtyn
                          END deliverydtyn
                        , CASE WHEN ISNULL(g.soldoutyn,'')=''
                                 THEN 'N'
                               ELSE g.soldoutyn
                          END soldoutyn, ISNULL(s.gdcnt,99999) gdcnt
                        , g.mgdimg1
                        , g.thedaysyn
                        , g.shortdesc
                        , ISNULL(t.cdname,'미지정') AS gradedesc
                   FROM gd_master g
                     JOIN cd_master c
                       ON c.cdtype = '20'
                      AND c.cdcode = div1
                     LEFT JOIN gd_cnt s
                            ON g.gdcd = s.gdcd
                     LEFT JOIN gd_item i
                            ON i.gdcd = g.gdcd
                     LEFT JOIN cd_master t
                            ON t.cdtype = '09'
                           AND t.cdcode = i.typecd
                     LEFT JOIN wmsl_wssupp ws
                            ON ws.susuno = i.scode
                    WHERE 1 = 1
                      AND ((g.divcd = '30' AND g.useyn = 'Y') OR (g.divcd = '20' AND g.useyn = 'Y' AND g.gdcd IN (SELECT gdcd FROM gd_set WHERE gdsetyn='Y')))
                      AND g.gdcd IN ('99100177','99100178','99100181','99100184')
                   UNION ALL
                   SELECT '12' odtype
                        , r.type odtype2
                        , r.gdcd
                        , r.gdnm gdname
                        , g.unit
                        , g.price1
                        , dbo.getMasterPrice(g.gdcd) saleprice
                        , dbo.getProductPrice(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) groupsaleprice
                        , dbo.getIsGroupSaleGoods(#{strMEMGRPCD}, #{strGroupSalePolicy}, g.gdcd) isgroupsale
                        , g.gdimg
                        , g.divcd
                        , g.div1
                        , c.cdcode
                        , c.cdname
                        , CASE WHEN ISNULL(g.deliverydtyn,'')=''
                                 THEN 'N'
                               ELSE g.deliverydtyn
                          END deliverydtyn
                        , CASE WHEN ISNULL(g.soldoutyn,'')=''
                                 THEN 'N'
                               ELSE g.soldoutyn
                          END soldoutyn, ISNULL(s.gdcnt,99999) gdcnt
                        , g.mgdimg1
                        , g.thedaysyn
                        , g.shortdesc
                        , g.priceyn
                        , ISNULL(t.cdname,'미지정') AS gradedesc
                   FROM od_reservegoods r
                     JOIN gd_master g
                       ON g.gdcd = r.gdcd
                     JOIN cd_master c
                       ON c.cdtype = '20'
                      AND c.cdcode = div1
                     LEFT JOIN gd_cnt s
                            ON g.gdcd = s.gdcd
                     LEFT JOIN gd_item i
                            ON i.gdcd = g.gdcd
                     LEFT JOIN cd_master t
                            ON t.cdtype = '09'
                           AND t.cdcode = i.typecd
                     LEFT JOIN wmsl_wssupp ws
                            ON ws.susuno = i.scode
                    WHERE 1 = 1
                      AND r.useyn='Y'
                      <![CDATA[
                      AND r.od_from <= CONVERT(CHAR(10), GETDATE(), 121)
                      AND r.od_to >= CONVERT(CHAR(10), GETDATE(), 121)
                      ]]>
                      AND r.gdcd IN ('99100177','99100178','99100181','99100184')
              ) a
           WHERE 1 = 1
    </select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dopostponeorder">
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 자연이랑모바일 - 이렇게 살까?
    'File          : likethis_m.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hwkim
    'Date Started  : 20130529
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification
    '-&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;    &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
    '20130529   hwkim   0.9     처음 작성
    '20161130   hwkim   0.9.1   리뉴얼
    '20170310   hwkim   0.9.2   아이디 키 전달 시 암호화 / 복호화 AES
    '20170313   hwkim   0.9.3   장바구니 구조변경-->
    <select id="getMemberDiscountPolicy">
       /*getMemberDiscountPolicy 해당아이디의 할인정책을 구함 */
        SELECT a.grpcd
             , CASE WHEN ISNULL(b.salepolicy,'')='' THEN 'N'
                    ELSE b.salepolicy
               END salepolicy
        FROM mb_master a
          LEFT JOIN mb_group b
                 ON b.grpcd = a.grpcd
      WHERE a.memcd = #{memcdx}
    </select>
    
    <select id="suggestionProdList">
        /*suggestionProdList 추천상품*/
        SELECT CASE t2.divcd WHEN '10' THEN 'PKG' 
                             ELSE od_gubun 
               END AS odtype 
             , t.crtidx
             , t.gdcd
             , t2.unit
             , t2.gdname 
             , CASE WHEN t2.qtysaleyn='Y' THEN dbo.getQtySalePrice(t.gdcd, t.gdcnt, dbo.getProductPrice(#{strMemberGroup},#{strGroupSaleFlag},t.gdcd)) 
                    ELSE dbo.getProductPrice(#{strMemberGroup},#{strGroupSaleFlag},t.gdcd) 
               END * ISNULL(t6.weekcnt, 1) AS price 
             , t.gdcnt 
             , CASE WHEN t2.qtysaleyn='Y' THEN dbo.getQtySalePrice(t.gdcd, t.gdcnt, dbo.getProductPrice(#{strMemberGroup},#{strGroupSaleFlag},t.gdcd)) 
                    ELSE dbo.getProductPrice(#{strMemberGroup},#{strGroupSaleFlag},t.gdcd) 
               END * ISNULL(t6.weekcnt, 1) * t.gdcnt AS tsales 
             , ISNULL(t5.gdcnt, 9999) limitgdcnt 
             , t2.gdimg, t2.div1, dbo.getIsGroupSaleGoods(#{strMemberGroup},#{strGroupSaleFlag},t.gdcd) issale 
             , CASE WHEN ISNULL(t2.qtysaleyn,'')='' THEN 'N' 
                    ELSE t2.qtysaleyn 
               END qtysaleyn 
             , t2.soldoutyn 
        FROM shopping_basket t
          JOIN gd_master t2
            ON t2.gdcd = t.gdcd
          LEFT JOIN gd_cnt t5
                 ON t5.gdcd = t.gdcd
          LEFT JOIN gd_pack t6
                 ON t6.gdcd = t2.gdcd
         WHERE t.memcd = #{memcdx}
        ORDER BY od_gubun, crtidx
    </select>
</mapper>
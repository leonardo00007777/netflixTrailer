<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="m62salep">
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 자연이랑모바일 - 포인트 결제방법 별 조회
    'File          : m62salep010.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hwkim
    'Date Started  : 20170119
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification
    '-&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;    &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
    '20170119   hwkim   0.9     처음 작성
    '20170119   hwkim   0.9.1   (특정)PG사 별 결제액 조회 확장.-->
    <select id="getGroupCode">
        /* getGroupCode 고객 코드*/
        SELECT grpcd
             , grpname
        FROM mb_group
         WHERE useyn = 'Y'
        ORDER BY grpname
    </select>
    
    <select id="getAllCompany">
        /* getAllCompany 고객 정보*/
        SELECT cdcode
             , cdname
             , useyn
        FROM cd_master
         WHERE cdtype = #{typeGrade}
           AND useyn = 'Y'
        ORDER BY CDCODE DESC
    </select>

    <select id="getCompanyPayment">
        /* getCompanyPayment 고객그룹 결제내역*/
        SELECT p.paydt
             , m.grpcd
             , g.grpname
             , p.ttlprice
             , ISNULL(p.bnpprice,0) bnpprice
             , p.paynum
        FROM od_pay p
          JOIN mb_master m
            ON p.MEMCD = m.MEMCD
          JOIN MB_GROUP g
            ON g.GRPCD = m.GRPCD
        WHERE 1=1
          AND p.paystcd = #{paystPay}
        <choose>
            <when test='pntype == "BP" '>
              <![CDATA[
                AND ISNULL(bnpprice,0) > 0
              ]]>
            </when>
            <when test='pntype == "SP" '>
                AND p.pgcd = '02'
            </when>
            <when test='pntype == "NP" '>
                AND p.pgcd = '03'
            </when>
            <otherwise>
                <![CDATA[
                AND ISNULL(bnpprice,0) > 0
                ]]>
            </otherwise>
        </choose>
        <![CDATA[
        AND p.paydt >= CONVERT(DATETIME,#{startDate},21)
        AND p.paydt < CONVERT(DATETIME,#{endDate},21)+1
        ]]>
        <if test='groupcd != ""'>
            <choose>
                <when test='groupcd == "BIG6"'>
                    AND m.grpcd IN (#{groupcd})
                </when>
                <otherwise>
                    AND m.grpcd = #{groupcd}
                </otherwise>
            </choose>
        </if>
    </select>
<!--    'System        : m.62life.com
    'Program       :
    'Title         : 자연이랑모바일 - 포인트 결제방법 별 조회
    'File          : m62salep010.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hwkim
    'Date Started  : 20170119
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification
    '-&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;    &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
    '20170119   hwkim   0.9     처음 작성-->

    <select id="pointPaymentDetail">
        /* pointPaymentDetail 포인트 결제 상세*/
        SELECT gdcd,gdname,price,gdcnt
        FROM od_goods
         WHERE 1=1
           AND paynum = #{paynum}
        ORDER BY ordnum, gdcd
    </select>
</mapper>
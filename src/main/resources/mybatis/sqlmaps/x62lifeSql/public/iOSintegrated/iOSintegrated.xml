<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="iOSIntegrated">
<!--    'System        : 62life.com
    'Program       :
    'Title         : iOS FCM 앱 알림 수신 동의/거부 처리
    'File          : ios/agreepush.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hwkim
    'Date Started  : 20190107
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification

    '20190107   hwkim   1.0     처음작성
    '20200428	hwkim	1.1		동의여부 정보가 NULL일경우 'Y'로 처리함. (사용자가 추후 직접 설정하도록)-->
    <update id="tokenUpdate">
        /*tokenUpdate iOS token 업데이트*/
        UPDATE fcm_62life 
           SET agree = #{agree}
             , agreedt = getdate()
         WHERE regid = #{token}
    </update>
    <insert id="addToken">
        /*addToken iOS token 추가*/
        INSERT INTO fcm_62life(
                                regid
                              , memcd
                              , indt
                              , agree
                              , agreedt
                              , version
                              ) 
               VALUES(
                       #{token}
                     , ''
                     , getdate()
                     , #{agree}
                     , getdate()
                     , #{ver}
                     )
    </insert>

<!--    'System        : 62life.com
    'Program       :
    'Title         : iOS FCM memer code 등록 처리
    'File          : ios/matchfcmtoken.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hwkim
    'Date Started  : 20190107
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification

    '20190107   hwkim   1.0     처음작성
    '20200519   hwkim   1.1     agree, agreedt 기본 값 수신 허용으로 처리-->
    <update id="updateFcmToken">
        /*updateFcmToken iOS Fcm 토큰 업데이트*/
        UPDATE fcm_62life 
           SET memcd = #{memcd}
             , agree = ISNULL(agree,'Y')
             , agreedt = ISNULL(agreedt,getdate())
         WHERE regid = #{token}
    </update>
    <insert id="insertFcmToken">
        /*insertFcmToken iOS Fcm 토큰 추가*/
        INSERT INTO fcm_62life(
                                regid
                              , memcd
                              , indt
                              , agree
                              , agreedt
                              , version
                              ) 
               VALUES(
                       #{token}
                     , #{memcd}
                     , getdate()
                     , 'Y'
                     , getdate()
                     , #{ver}
                     )
    </insert>

<!--    'System        : 62life.com
    'Program       :
    'Title         : iOS FCM 기기 등록 처리
    'File          : ios/setfcmtoken.asp
    'Program Type  : asp
    'Analyst       :
    'Author        : hwkim
    'Date Started  : 20190107
    'Last Modified :
    'Called By     :
    'Parameters    :
    'Purpose       :
    'Version       :
    '
    'Modified   Author  V/M     Reason For Modification

    '20190107   hwkim   1.0     처음작성
    '20200717   hwkim   1.1     버전정보 기본값 추가-->

    <insert id="insertFcmDeviceInfo">
        /*insertFcmDeviceInfo Fcm디바이스 정보 추가*/
        INSERT INTO fcm_62life(
                                regid
                              , memcd
                              , indt
                              , agree
                              , agreedt
                              , version
                              )
               VALUES (
                        #{token}
                      , #{memcd}
                      , getdate()
                      , 'Y'
                      , getdate()
                      , #{ver}
                      )
    </insert>
</mapper>
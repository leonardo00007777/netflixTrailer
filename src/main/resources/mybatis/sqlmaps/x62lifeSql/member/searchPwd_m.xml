<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="searchPwd">
<!--    '프로젝트: 자연이랑 모바일 웹-->
<!--    '프로그램: 비밀번호 찾기-->

<!--    '20170306   sykim   처음작성-->
<!--    '20170315   hwkim   레이아웃 표준화-->
<!--    '20171013   sykim   이름, 아이디 입력과 본인인증 후 비밀번호 변경하도록 변경.-->
<!--    '20190321   sykim   IPIN Version 2 적용.-->
    <select id="getMemberEmail" statementType="CALLABLE">
        {CALL encryptionOpen
        SELECT memid
             , memname
             , CONVERT(VARCHAR(40),DECRYPTBYKEY(email_enc)) email
        FROM mb_master
         WHERE memcd = #{strMemCd}
          <![CDATA[
           AND memstcd <= #{memstUp}
          ]]>
        CALL encryptionClose}
    </select>

    <update id="updateNewPassword">
        UPDATE mb_master
           SET mempw_hash = CONVERT(VARCHAR(1000),HASHBYTES('SHA2_256',#{strMemPw}),2)
        WHERE memcd = #{strMemCd}
    </update>

    <update id="unlockAccount">
        /* unlockAccount 계정잠김 해제*/
        UPDATE logininfo
        SET islocked = 0
          , login_failed_count = 0
        WHERE memcd = #{strMemCd}
    </update>
</mapper>
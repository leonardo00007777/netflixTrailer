<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="joinProcess">
<!--    '프로젝트: 자연이랑 모바일 웹-->
<!--    '프로그램: 회원가입 - 가입처리-->

<!--    '20170331   hyeok   처음작성-->
<!--    '20181011   sykim   전화번호의 개행문자, 줄바꿈 없애기.-->

    <select id="memIdOverlapCheck">
        /* memIdOverlapCheck 멤버ID 중복 체크*/
        SELECT memid
        FROM mb_master
         WHERE memid = #{strMemId}
    </select>

    <insert id="memInfoInsert" statementType="CALLABLE">
        /* memInfoInsert 회원가입정보 Insert*/
        {CALL encryptionOpen
        INSERT INTO mb_master (
                                 memcd
                               , memid
                               , mempw
                               , memname
                               , grpcd 
                               , gradecd
                               , empnum
                               , memstcd
                               , upgradedt
                               , residentno1
                               , residentno1_enc 
                               , gender
                               , email
                               , email_enc
                               , emailyn
                               , zipcd 
                               , addr1
                               , addr1_enc
                               , addr2
                               , addr2_enc
                               , telno
                               , telno_enc
                               , hpno
                               , hpno_enc 
                               , indt
                               , smsyn
                               , telyn
                               , updid
                               , mempw_hash 
                               , contract_agree
                               , policy_agree
                               , entrust_agree
                               , pcert_reqno
                               , pcert_di 
                               , emailynupdt
                               , smsynupdt 
                             ) 
               VALUES (
                        #{strMemCd}
                      , #{strMemId}
                      , ' '
                      , #{strMemName}
                      , #{insertGroupCode}
                      , #{gradeC}
                      , ''
                      , #{insertMemStatus}
                      , NULL
                      , ' '
                      , ENCRYPTBYKEY(KEY_GUID(#{encKeyName}), #{strResidentNo1})
                      , #{strGender}
                      , ' '
                      , ENCRYPTBYKEY(KEY_GUID(#{encKeyName}), #{strEmail})
                      , #{strEmailYN}
                      , #{strZipCd}
                      , ' '
                      , ENCRYPTBYKEY(KEY_GUID(#{encKeyName}), N#{strAddr1})
                      , ' '
                      , ENCRYPTBYKEY(KEY_GUID(#{encKeyName}), N#{strAddr2})
                      , ' '
                      , ENCRYPTBYKEY(KEY_GUID(#{encKeyName}), #{strTelNo})
                      , ' '
                      , ENCRYPTBYKEY(KEY_GUID(#{encKeyName}), #{strHpNo})
                      , GETDATE()
                      , #{strSmsYn}
                      , #{strTelYn}
                      , #{strMemCd}
                      , dbo.UBHASHFunc('SHA256',#{strMemPw})
                      , 'Y'
                      , 'Y'
                      , 'Y'
                      , #{strReqNo}
                      , #{strPidNo}
                      , GETDATE()
                      , GETDATE()
                      )
        CALL encryptionClose}
    </insert>
    
    <insert id="passChangeLogInsert">
        /* passChangeLogInsert 패스워드 변경 로그 insert*/
        INSERT INTO changefieldhistory(
                                        memcd
                                      , memid
                                      , date_mempw
                                      )  
               VALUES (
                        #{strMemCd}
                      , #{strMemId}
                      , GETDATE()
                      )
    </insert>

    <insert id="pointInsert">
        /*pointInsert 포인트 Insert*/
        INSERT INTO mb_currency (
                                  memcd
                                )
               VALUES (
                        #{strMemCd}
                      )
    </insert>

    <select id="getSkMemInfo">
        /*getSkMemInfo sk 회원정보 get*/
        SELECT memcd
             , memid
             , memname
        FROM mb_master
         WHERE memstcd NOT IN (#{memstOut})
           AND memid = #{strMemID}
    </select>
</mapper>
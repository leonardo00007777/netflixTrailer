<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.x62life.mo.dao.category.CategoryDao">
<!--    'System        : m.62life.com-->
<!--    'Program       :-->
<!--    'Title         : 자연이랑모바일 - 고객이 직접 만드는 묶음상품 상세정보-->
<!--    'File          : custsetdetail_m.asp-->
<!--    'Program Type  : asp-->
<!--    'Analyst       :-->
<!--    'Author        : hwkim-->
<!--    'Date Started  : 20151107-->
<!--    'Last Modified :-->
<!--    'Called By     :-->
<!--    'Parameters    :-->
<!--    'Purpose       :-->
<!--    'Version       :-->
<!--    '-->
<!--    'Modified   Author  V/M     Reason For Modification-->
<!--    '-&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;&#45;&#45;  &#45;&#45;&#45;&#45;    &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--    '20151107   hwkim   0.9     처음 작성-->
<!--    '20161205   hyeok   0.9.1   사이트 리뉴얼 layout적용-->
<!--    '20161212   hwkim   0.9.2   레이아웃 표준 규칙 수정-->
    <select id="custSetTitle" parameterType="java.util.Map" resultType="cartRecipe">
     /* custSetDetailSetTitle 고객이 직접만드는 묵음상품 title세팅*/
        SELECT t.titlex
             , t.indt
             , t.hmemo
             , t.memcd
             , t.pic1
             , t2.memname
             , t2.memid
             , t.icount
             , t.scount
             , t.rcount
        FROM CART_RECIPE_HEADER t
          JOIN MB_MASTER t2 ON t.memcd = t2.memcd
         WHERE t.hseqno = #{hseqno}
           AND share='Y'
    </select>

    <update id="visitorCnt" parameterType="java.util.Map">
    /*visitorCnt 방문자 카운트 (글 작성자, 미로그인자일 경우 방문 카운트를 기록하지 않음)*/
        UPDATE CART_RECIPE_HEADER
           SET icount = icount+1
        WHERE hseqno = #{hseqno}
    </update>

<!--    <select id="getTagList" parameterType="java.util.Map" resultType="com.x62life.mo.model.product.BasicTagMap">
        /* getTagList 태그목록 획득 */
        SELECT (SELECT btname FROM basictag WHERE btidx = t.btidx) AS btname
        FROM basictagmap t
         WHERE btype = #{tagTypeCartrecipe}
           AND bidx = #{hseqno}
    </select>-->

    <select id="getCartRecipeProdList" parameterType="java.util.Map" resultType="cartRecipeEx">
        /* getCartRecipeProdList 상품목록 */
        SELECT t.gdcd
             , t.gdqty
             , t.lmemo
             , gm.gdname
             , gm.useyn
             , gm.soldoutyn
             , ISNULL(gc.gdcnt , 99999) AS gdcnt
             , gm.gdimg
             , gm.price1
             , dbo.getProductPrice('96','M',t.gdcd) price
        FROM CART_RECIPE_LINE t
          JOIN GD_MASTER gm
            ON t.gdcd = gm.gdcd
          LEFT JOIN GD_CNT gc
                 ON t.gdcd = gc.GDCD
         WHERE t.lseqno = #{hseqno}
        ORDER BY t.lno
    </select>
</mapper>